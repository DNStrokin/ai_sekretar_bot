# История изменений

Все значимые изменения проекта документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.1.0/).
Проект следует [Семантическому версионированию](https://semver.org/lang/ru/).

## [Unreleased]
### Изменено
- Обновлена модель Gemini на `gemini-3-flash-preview`.

## [0.2.1] - 2025-12-28

### Изменено

- **Рефакторинг кода бота**
  - Создан сервисный слой `src/services/db_service.py` для работы с БД (User, Group, Topic)
  - Выделены клавиатуры в `src/bot/keyboards.py` и состояния FSM в `src/bot/states.py`
  - Устранено дублирование кода между `group_commands.py` и `handlers.py`
  - Оптимизированы импорты и структура модулей

## [0.3.1] - 2025-12-28

### Добавлено

- **Система шаблонов заметок**
  - Поддержка пользовательских форматов через команду `/format`
  - Поддержка HTML-тегов (`<b>`, `<i>`, `<s>`, `<code>`, etc.)
  - Переменные шаблона: `[title]`, `[caption]`, `[message]`, `[tags]`, `[date]`, `[url]`, `[username]`
  - Стандартизация AI-промптов (отделение стиля от содержания)

## [0.3.0] - 2025-12-28

### Добавлено

- **AI Интеграция (Gemini)**
  - Реализован провайдер `GeminiProvider` с использованием Google Gemini API
  - Поддержка модели `gemini-2.5-flash-lite`
  - Строгая типизация запросов (JSON mode)
  - Принудительное использование русского языка для заметок
- **Умный буфер (General)**
  - Автоматическая классификация сообщений из основной темы (General)
  - Перенаправление сообщений в соответствующие топики
  - Очистка буфера: удаление исходного сообщения и автоудаление служебных уведомлений через 30 сек
  - Режим "Сомнения": если AI не уверен, бот предлагает пользователю выбрать тему (или все сразу)
- **Технические улучшения**
  - Удалена ссылка на пользователя в заметках (приватный режим)
  - Более надежная обработка ошибок AI с выводом в чат (в отладочном режиме)


### Изменено

- Объединены команды `/init` и `/info` в одну умную команду `/info`
- Удалены ReplyKeyboard кнопки (не работают в desktop Telegram)

## [0.1.0] - 2025-12-28

### Добавлено

- Начальная структура проекта на основе технической документации
- **bot-api** — основной сервис (aiogram 3 + FastAPI)
  - Обработчики команд Telegram (`/start`, `/help`, `/settings`)
  - REST API для WebApp (управление темами и настройками)
  - Абстракция AI-провайдеров (OpenAI, Gemini)
  - Интерфейс STT-сервиса
  - Асинхронные модели SQLAlchemy 2.x
  - Настройка миграций Alembic
  - Конфигурация через Pydantic Settings
- **worker** — фоновый сервис (Celery)
  - Задачи транскрипции голосовых сообщений
  - Извлечение метаданных из URL
  - Обработка файлов
- **Инфраструктура**
  - Docker Compose (bot-api, worker, postgres, redis)
  - Конфигурация Nginx reverse proxy
  - Pre-commit хуки (ruff, black, mypy)
- **Документация**
  - README.md с инструкцией по запуску
  - AI_RULES.md — правила для AI-агентов
  - Техническое задание (specification.md)
  - Описание стека (tech_stack.md)
  - Дизайн взаимодействия с LLM (llm_interaction_design.md)

[0.2.0]: https://github.com/DNStrokin/ai_sekretar_bot/compare/v0.1.0...v0.2.0
[0.1.0]: https://github.com/DNStrokin/ai_sekretar_bot/releases/tag/v0.1.0
